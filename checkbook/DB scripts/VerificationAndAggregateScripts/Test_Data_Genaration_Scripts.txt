-- Latest Scripts as of 2013-02-20


-- Accounting|Advertising|Asset Management|Customer Relations|Customer Service|Finances|Human Resources|Legal Department|Media Relations|Payroll|Public Relations|Quality Assurance|Sales and Marketing|Research and Development|Tech Support
/*
Preliminary Requirements:
Sample data would contain data only for Ten agencies.
The data would span across multiple years-2010,2011 and 2012,2013.
The data for few columns for spending, payroll and contracts domain would be changed to use sample data. 
We will not be modifying the amounts  within contracts and spending domain as we have to match both these amounts as we include contracts and spending data within each domain.
 
Note: We have identified few fields which are most commonly used within these three domains throughout the application to be updated to use sample data as listed below. Please let us know if there are any other fields that need to be masked for sample data.
 
Sample Data Approach:
1.       COA Elements :
Tables to be modified:
1.       Department(Agency)
2.       Appropriation(Department)
3.       Expenditure Object

2.       Contracts Domain: Will be modifying contracts data for Ten Agencies. Fields to be modified are:-
 Contract Number -  Make sure the relationships between child contracts and parent contracts are not broken as you rename both. 
 Agency Name
 Department Name
 Vendor Name
 Award Method Name
 Contract Purpose
 Contract Industry Name
3.       Spending Domain : Will be modifying contracts data for Ten Agencies. Fields to be modified are:-
  Disbursement Number
  Vendor Name
  Agency Name
  Department Name
  Expense Category Name
4.       Payroll Domain: Will be modifying contracts data for Ten Agencies. Fields to be modified are:-
 Civil Service Title. 
  Employee Number
  Agency  Name
  Department Name
  
  */
  
  
  -- needs to add agencies with the codes (added)  '057','068','072','095','103','131','156','801','806','816','820','826','827','841','856','858'
  
  


--  Reference Tables

-- COA Agency

DELETE FROM etl.stg_agency WHERE agency_code NOT IN  ('781','003','102','042','130','810','836','126','127','819','DSB','856','827','858','156','068','095','816','103','841','820','806','131','826','801','072');

UPDATE etl.stg_agency SET  agency_name = 'Accounting Department', agency_short_name = 'ACD'  where agency_code = '003' ;
UPDATE etl.stg_agency SET  agency_name = 'Advertising Department', agency_short_name = 'ADD'  where agency_code = '042' ;
UPDATE etl.stg_agency SET  agency_name = 'Asset Management', agency_short_name = 'ASM'  where agency_code = '102' ;
UPDATE etl.stg_agency SET  agency_name = 'Customer Relations Department', agency_short_name = 'CRD'  where agency_code = '126' ;
UPDATE etl.stg_agency SET  agency_name = 'Customer Service Department', agency_short_name = 'CSD'  where agency_code = '127' ;
UPDATE etl.stg_agency SET  agency_name = 'Finance Department', agency_short_name = 'FID'  where agency_code = '130' ;
UPDATE etl.stg_agency SET  agency_name = 'Human resources', agency_short_name = 'HRD'  where agency_code = '781' ;
UPDATE etl.stg_agency SET  agency_name = 'Research And Development', agency_short_name = 'RAD'  where agency_code = '810' ;
UPDATE etl.stg_agency SET  agency_name = 'Sales And Marketing', agency_short_name = 'SAM'  where agency_code = '819' ;
UPDATE etl.stg_agency SET  agency_name = 'Public Relations', agency_short_name = 'PUR'  where agency_code = '836' ;

UPDATE etl.stg_agency SET  agency_name = 'Quality Assurance', agency_short_name = 'QAD'  where agency_code = '856' ;
UPDATE etl.stg_agency SET  agency_name = 'Legal Department', agency_short_name = 'LED'  where agency_code = '827' ;
UPDATE etl.stg_agency SET  agency_name = 'Media Relations', agency_short_name = 'MRD'  where agency_code = '858' ;
UPDATE etl.stg_agency SET  agency_name = 'IT Department', agency_short_name = 'ITD'  where agency_code = '156' ;
UPDATE etl.stg_agency SET  agency_name = 'Technology Support', agency_short_name = 'TSD'  where agency_code = '068' ;

UPDATE etl.stg_agency SET  agency_name = 'Fire Department', agency_short_name = 'FID'  where agency_code = '095' ;
UPDATE etl.stg_agency SET  agency_name = 'Development Board', agency_short_name = 'DEB'  where agency_code = '816' ;
UPDATE etl.stg_agency SET  agency_name = 'Manufacture Department', agency_short_name = 'MAD'  where agency_code = '103' ;
UPDATE etl.stg_agency SET  agency_name = 'TeleCommunications Department', agency_short_name = 'TCD'  where agency_code = '841' ;
UPDATE etl.stg_agency SET  agency_name = 'Airport Development', agency_short_name = 'AID'  where agency_code = '820' ;

UPDATE etl.stg_agency SET  agency_name = 'Misc Department1', agency_short_name = 'MID1'  where agency_code = '806' ;
UPDATE etl.stg_agency SET  agency_name = 'Misc Department2', agency_short_name = 'MID2'  where agency_code = '131' ;
UPDATE etl.stg_agency SET  agency_name = 'Misc Department3', agency_short_name = 'MID3'  where agency_code = '826' ;
UPDATE etl.stg_agency SET  agency_name = 'Misc Department4', agency_short_name = 'MID4'  where agency_code = '801' ;
UPDATE etl.stg_agency SET  agency_name = 'Misc Department5', agency_short_name = 'MID5'  where agency_code = '072' ;




-- COA Department

DELETE FROM etl.stg_department WHERE agency_code NOT IN  ('781','003','102','042','130','810','836','126','127','819','DSB','856','827','858','156','068','095','816','103','841','820','806','131','826','801','072');

DROP SEQUENCE IF EXISTS mtr_seq_temp_stg_ref_dept_name cascade;

CREATE SEQUENCE mtr_seq_temp_stg_ref_dept_name;

DROP TABLE IF EXISTS mtr_change_deptname;

CREATE TABLE mtr_change_deptname(
	dept_id int PRIMARY KEY default nextval('mtr_seq_temp_stg_ref_dept_name'),
	agency_code varchar(3),
	department_code varchar(3),
	agency_short_name varchar(5)
	)
DISTRIBUTED BY (dept_id);


INSERT INTO mtr_change_deptname(agency_code, department_code, agency_short_name) SELECT distinct b.agency_code, b.department_code, a.agency_short_name from etl.stg_agency a, etl.stg_department b  WHERE a.agency_code = b.agency_code ;

UPDATE etl.stg_department a 
SET department_name = b.agency_short_name || ' DEPARTMENT ' || b.dept_id, 
    department_short_name = b.agency_short_name || '_DEPT_' || b.dept_id
FROM mtr_change_deptname b
WHERE a.agency_code = b.agency_code AND a.department_code = b.department_code;

-- COA Expenditure Object

DROP SEQUENCE IF EXISTS mtr_seq_temp_stg_ref_exp_object_name cascade;

CREATE SEQUENCE mtr_seq_temp_stg_ref_exp_object_name;

DROP TABLE IF EXISTS etl.stg_expenditure_object_mtr;


CREATE TABLE etl.stg_expenditure_object_mtr(
	exp_obj_id int PRIMARY KEY default nextval('mtr_seq_temp_stg_ref_exp_object_name'),
	expenditure_object_code varchar(4)
	)
DISTRIBUTED BY (exp_obj_id);

INSERT INTO etl.stg_expenditure_object_mtr(expenditure_object_code) select distinct expenditure_object_code from etl.stg_expenditure_object;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'AIR FARE ' || b.exp_obj_id , col5 = 'AF_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^0[0-4][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'CAR RENTAL ' || b.exp_obj_id , col5 = 'CR_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^0[5-6][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'ACCOMMODATION ' || b.exp_obj_id , col5 = 'AC_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^0[7-9][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'REAL PROPERTY LEASE ' || b.exp_obj_id , col5 = 'RPL_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^1[0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'BUILDING REPAIRS ' || b.exp_obj_id , col5 = 'BR_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^2[0-1][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'NATURAL GAS ' || b.exp_obj_id , col5 = 'NG_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^2[2-3][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'ELECTRICITY ' || b.exp_obj_id , col5 = 'EL_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^2[4-9][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'STOCKS ' || b.exp_obj_id , col5 = 'ST_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^3[0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'OFT TELECOMMUNICATIONS ' || b.exp_obj_id , col5 = 'OTC_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^40[0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'OFT COMPUTER SERVICES ' || b.exp_obj_id , col5 = 'OCS_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^4[1-2][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'TELEPHONE SERVICES ' || b.exp_obj_id , col5 = 'TS_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^4[3-5][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'IT TELECOMMUNICATION SERVICES ' || b.exp_obj_id , col5 = 'ITTS_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^4[6-8][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'IT SERVICES ' || b.exp_obj_id , col5 = 'ITS_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^49[0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'JURY SERVICES ' || b.exp_obj_id , col5 = 'JS_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^5[0-1][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'PRINTING ' || b.exp_obj_id , col5 = 'PR_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^5[2-9][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'ADVERTISING ' || b.exp_obj_id , col5 = 'AD_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^6[0-3][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'VEHICLES ' || b.exp_obj_id , col5 = 'VH_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^6[4-5][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'STUDENT FEES ' || b.exp_obj_id , col5 = 'SF_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^6[6-9][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'MEDICAL EQUIPMENT ' || b.exp_obj_id , col5 = 'ME_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^7[0-1][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'HEALTH INSURANCE ' || b.exp_obj_id , col5 = 'HI_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^7[2-5][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'HOSPITAL MEDICARE ' || b.exp_obj_id , col5 = 'HM_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^7[6-9][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'COMISSIONS ' || b.exp_obj_id , col5 = 'CO_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^8[0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'DIVIDENDS ' || b.exp_obj_id , col5 = 'DI_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^[9|[A-Za-z][0-9a-zA-Z]*$' ;


-- COA LOCATION

DELETE from etl.stg_location where agency_code NOT IN ('781','003','102','042','130','810','836','126','127','819','DSB','856','827','858','156','068','095','816','103','841','820','806','131','826','801','072');

-- COA Budget Code

DELETE from etl.stg_budget_code where dept_cd NOT IN ('781','003','102','042','130','810','836','126','127','819','DSB','856','827','858','156','068','095','816','103','841','820','806','131','826','801','072');


--  COA Object Class

UPDATE etl.stg_object_class  SET object_class_name = 'Object Class ' || object_class_code;

-- COA Revenue Category 

UPDATE etl.stg_revenue_category  SET rscat_nm = 'Revenue Category ' || rscat_cd;

-- COA Revenue Class 

UPDATE etl.stg_revenue_class  SET rscls_nm = 'Revenue Class ' || rscls_cd;

-- COA Funding Class 

UPDATE etl.stg_funding_class  SET funding_class_name = 'Funding Class ' || funding_class_code;

-- COA Revenue Source 

UPDATE etl.stg_revenue_source  SET rsrc_nm = 'Revenue Source ' || rsrc_cd;



-- COA Vendor

UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'0','M') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'1','W') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'2','A') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'3','F') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'4','K') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'5','T') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'6','R') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'7','U') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'8','N') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'9','E') ;




-- Contracts Domain

 

-- Master Agreements


DELETE from etl.stg_mag_header where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819') ;
DELETE from etl.stg_mag_award_detail where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819')  ;
DELETE from etl.stg_mag_vendor where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819') ;

-- MAG header changes

UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'0','M')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'2','N')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'3','Y')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'4','T')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'5','R')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'6','U')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'7','E')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'8','J')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'9','D')  ;

UPDATE etl.stg_mag_header a 
SET doc_dscr =  doc_cd || doc_dept_cd || doc_id || ' contract is for ' || b.agency_short_name 
FROM etl.stg_agency b WHERE a.doc_dept_cd = b.agency_code;

-- MAG Award Detail Changes

UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'9','D') ;


-- MAG Vendor

UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'9','D') ;


UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'0','M') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'1','W') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'2','A') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'3','F') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'4','K') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'5','T') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'6','R') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'7','U') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'8','N') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'9','E') ;


UPDATE etl.stg_mag_vendor SET lgl_nm = 'VENDOR ' || vend_cust_cd, alias_nm = '', ad_ln_1 = 'Address Line 1' , ad_ln_2 = '' ;


--Contracts :

DELETE from etl.stg_con_ct_header where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_ct_accounting_line where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_ct_award_detail where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_ct_vendor where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');


DELETE from etl.stg_con_do1_header where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_do1_accounting_line where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_do1_vendor where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');

DELETE from etl.stg_con_po_header where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_po_accounting_line where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_po_award_detail where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_po_vendor where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');

-- CT header changes

UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'0','M'), oca_no = replace(oca_no,'0','M') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'1','A'), oca_no = replace(oca_no,'1','A') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'2','N'), oca_no = replace(oca_no,'2','N') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'3','Y'), oca_no = replace(oca_no,'3','Y') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'4','T'), oca_no = replace(oca_no,'4','T') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'5','R'), oca_no = replace(oca_no,'5','R') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'6','U'), oca_no = replace(oca_no,'6','U') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'7','E'), oca_no = replace(oca_no,'7','E') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'8','J'), oca_no = replace(oca_no,'8','J') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'9','D'), oca_no = replace(oca_no,'9','D') ;

UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'0','M')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'1','A') ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'2','N')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'3','Y')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'4','T')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'5','R')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'6','U')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'7','E')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'8','J')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'9','D')  ;



UPDATE etl.stg_con_ct_header a 
SET doc_dscr =  a.doc_cd || a.doc_dept_cd || a.doc_id || ' contract is for ' || b.agency_short_name 
FROM etl.stg_agency b WHERE a.doc_dept_cd = b.agency_code;

-- UPDATE etl.stg_con_ct_header SET agree_doc_dept_cd = doc_dept_cd ;

-- CT accounting line changes

UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'9','D') ;

UPDATE etl.stg_con_ct_accounting_line SET dept_cd = doc_dept_cd;

-- CT Award Detail Changes

UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'9','D') ;


-- CT Vendor

UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'9','D') ;


UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'0','M') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'1','W') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'2','A') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'3','F') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'4','K') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'5','T') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'6','R') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'7','U') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'8','N') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'9','E') ;


UPDATE etl.stg_con_ct_vendor SET lgl_nm = 'VENDOR ' || vend_cust_cd, alias_nm = '', ad_ln_1 = 'Address Line 1' , ad_ln_2 = '' ;


-- DO header changes

UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'0','M')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'1','A');
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'2','N')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'3','Y')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'4','T')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'5','R')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'6','U')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'7','E')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'8','J')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'9','D')  ;

UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'0','M')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'1','A') ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'2','N')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'3','Y')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'4','T')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'5','R')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'6','U')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'7','E')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'8','J')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'9','D')  ;


UPDATE etl.stg_con_do1_header a 
SET doc_dscr =  a.doc_cd || a.doc_dept_cd || a.doc_id || ' contract is for ' || b.agency_short_name 
FROM etl.stg_agency b WHERE a.doc_dept_cd = b.agency_code;

-- UPDATE etl.stg_con_do1_header SET agree_doc_dept_cd = doc_dept_cd ;

-- DO accounting line changes

UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'9','D') ;

UPDATE etl.stg_con_do1_accounting_line SET dept_cd = doc_dept_cd;

-- DO Vendor

UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'9','D') ;


UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'0','M') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'1','W') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'2','A') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'3','F') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'4','K') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'5','T') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'6','R') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'7','U') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'8','N') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'9','E') ;


UPDATE etl.stg_con_do1_vendor SET lgl_nm = 'VENDOR ' || vend_cust_cd, alias_nm = '', ad_ln_1 = 'Address Line 1' , ad_ln_2 = '' ;


-- PO header changes

UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'0','M')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'2','N')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'3','Y')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'4','T')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'5','R')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'6','U')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'7','E')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'8','J')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'9','D')  ;

UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'0','M')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'1','A') ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'2','N')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'3','Y')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'4','T')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'5','R')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'6','U')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'7','E')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'8','J')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'9','D')  ;

UPDATE etl.stg_con_po_header a 
SET doc_dscr =  a.doc_cd || a.doc_dept_cd || a.doc_id || ' contract is for ' || b.agency_short_name 
FROM etl.stg_agency b WHERE a.doc_dept_cd = b.agency_code;

-- UPDATE etl.stg_con_po_header SET agree_doc_dept_cd = doc_dept_cd ;

-- PO accounting line changes

UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'9','D') ;

UPDATE etl.stg_con_po_accounting_line SET dept_cd = doc_dept_cd;

-- PO Award Detail Changes

UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'9','D') ;


-- PO Vendor

UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'9','D') ;


UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'0','M') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'1','W') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'2','A') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'3','F') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'4','K') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'5','T') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'6','R') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'7','U') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'8','N') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'9','E') ;


UPDATE etl.stg_con_po_vendor SET lgl_nm = 'VENDOR ' || vend_cust_cd, alias_nm = '', ad_ln_1 = 'Address Line 1' , ad_ln_2 = '' ;



-- Spending Domain


DELETE FROM etl.stg_fms_accounting_line WHERE  rqporf_doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819') ;


DROP TABLE IF EXISTS etl.stg_fms_header_mtr;

CREATE TABLE etl.stg_fms_header_mtr as SELECT distinct  a.* FROM etl.stg_fms_header a , (select distinct doc_cd, doc_id, doc_dept_cd, doc_vers_no from etl.stg_fms_accounting_line) b WHERE a.doc_cd=b.doc_cd AND a.doc_id =b.doc_id AND a.doc_dept_cd = b.doc_dept_cd AND a.doc_vers_no = b.doc_vers_no ;

DELETE FROM etl.stg_fms_header WHERE uniq_id NOT IN (select distinct uniq_id FROM etl.stg_fms_header_mtr);


DROP TABLE IF EXISTS etl.stg_fms_vendor_mtr;

CREATE TABLE etl.stg_fms_vendor_mtr as SELECT distinct  a.* FROM etl.stg_fms_vendor a , (select distinct doc_cd, doc_id, doc_dept_cd, doc_vers_no from etl.stg_fms_accounting_line) b WHERE a.doc_cd=b.doc_cd AND a.doc_id =b.doc_id AND a.doc_dept_cd = b.doc_dept_cd AND a.doc_vers_no = b.doc_vers_no ;

DELETE FROM etl.stg_fms_vendor WHERE uniq_id NOT IN (select distinct uniq_id FROM etl.stg_fms_vendor_mtr);


-- FMS Header

UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'0','Y')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'2','T')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'3','I')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'4','S')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'5','H')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'6','R')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'7','E')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'8','D')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'9','M')  ;

-- FMS Accounting Line

UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'0','Y')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'2','T')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'3','I')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'4','S')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'5','H')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'6','R')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'7','E')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'8','D')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'9','M')  ;


UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'0','M') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'1','A') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'2','N') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'3','Y') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'4','T') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'5','R') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'6','U') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'7','E') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'8','J') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'9','D') ;

-- FMS Vendor

UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'0','Y')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'2','T')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'3','I')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'4','S')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'5','H')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'6','R')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'7','E')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'8','D')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'9','M')  ;


UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'0','M') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'1','W') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'2','A') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'3','F') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'4','K') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'5','T') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'6','R') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'7','U') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'8','N') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'9','E') ;


UPDATE etl.stg_fms_vendor SET lgl_nm = 'VENDOR ' || vend_cust_cd, alias_nm = '', ad_ln_1 = 'Address Line 1' , ad_ln_2 = '' ;


-- PAYROL Domain

-- Payroll Detail file

DROP TABLE IF EXISTS etl.stg_payroll_mtr;

CREATE TABLE etl.stg_payroll_mtr as SELECT * from etl.archive_payroll where agency_code in ('781','003','102','130','810','836','126','127','819');

TRUNCATE TABLE etl.stg_payroll ;

ALTER TABLE etl.stg_payroll_mtr DROP COLUMN load_file_id;

INSERT INTO etl.stg_payroll SELECT * FROM etl.stg_payroll_mtr;



UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'0','M') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'1','V') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'2','S') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'3','U') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'4','B') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'5','B') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'6','A') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'7','R') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'8','E') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'9','D') ;


UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'0','M') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'1','T') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'2','A') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'3','R') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'4','U') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'5','N') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'6','T') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'7','E') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'8','J') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'9','R') ;

UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'0','M') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'1','Y') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'2','A') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'3','T') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'4','I') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'5','S') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'6','H') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'7','R') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'8','E') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'9','D') ;

UPDATE etl.stg_payroll SET civil_service_title = 'CIVIL SERVICE TITLE ' || payroll_number || civil_service_code ;

-- PAYROL SUMMARY FILE

DELETE from etl.stg_payroll_summary  where agency NOT IN ('781','003','102','130','810','836','126','127','819') ;

UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'0','M') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'1','T') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'2','A') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'3','R') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'4','U') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'5','N') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'6','T') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'7','E') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'8','J') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'9','R') ;





UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Accounting Department'  where agency = '003' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Advertising Department'  where agency = '042' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Asset Management'  where agency = '102' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Customer Relations Department' where agency = '126' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Customer Service Department'  where agency = '127' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Finance Department' where agency = '130' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Human resources'  where agency = '781' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Research And Development'  where agency = '810' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Sales And Marketing' where agency = '819' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Public Relations'  where agency = '836' ;


UPDATE etl.stg_payroll_summary a 
SET   uoa_name = b.agency_short_name || ' DEPARTMENT ' || b.dept_id
FROM mtr_change_deptname b
WHERE a.agency = b.agency_code AND a.uoa = b.department_code;



-- PENDING Contracts


DELETE from etl.stg_pending_contracts where con_trans_ad_code NOT in ('781','003','102','042','130','810','836','126','127','819') ;

UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'0','M') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'1','A') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'2','N') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'3','Y') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'4','T') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'5','R') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'6','U') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'7','E') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'8','J') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'9','D') ;


UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'0','M') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'1','A') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'2','N') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'3','Y') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'4','T') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'5','R') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'6','U') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'7','E') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'8','J') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'9','D') ;


UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'0','M') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'1','W') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'2','A') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'3','F') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'4','K') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'5','T') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'6','R') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'7','U') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'8','N') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'9','E') ;

UPDATE etl.stg_pending_contracts SET vc_legal_name = 'VENDOR ' || con_vc_code, submitting_agency_code = con_trans_ad_code,awarding_agency_code = con_trans_ad_code ;

UPDATE etl.stg_pending_contracts a 
SET submitting_agency_desc = b.agency_name 
FROM etl.stg_agency b 
WHERE a.submitting_agency_code = b.agency_code;


UPDATE etl.stg_pending_contracts a 
SET awarding_agency_desc = b.agency_name 
FROM etl.stg_agency b 
WHERE a.awarding_agency_code = b.agency_code;


-- Budget Scripts

DELETE FROM etl.stg_budget WHERE agency_code NOT in ('781','003','102','042','130','810','836','126','127','819');

-- Revenue Scripts

DELETE FROM etl.stg_revenue WHERE dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');

UPDATE etl.stg_revenue SET pstng_cd_id = replace(pstng_cd_id,'0','M') ;
UPDATE etl.stg_revenue SET pstng_cd_id = replace(pstng_cd_id,'1','W') ;
UPDATE etl.stg_revenue SET pstng_cd_id = replace(pstng_cd_id,'2','A') ;
UPDATE etl.stg_revenue SET pstng_cd_id = replace(pstng_cd_id,'3','F') ;
UPDATE etl.stg_revenue SET pstng_cd_id = replace(pstng_cd_id,'4','K') ;
UPDATE etl.stg_revenue SET pstng_cd_id = replace(pstng_cd_id,'5','T') ;
UPDATE etl.stg_revenue SET pstng_cd_id = replace(pstng_cd_id,'6','R') ;
UPDATE etl.stg_revenue SET pstng_cd_id = replace(pstng_cd_id,'7','U') ;
UPDATE etl.stg_revenue SET pstng_cd_id = replace(pstng_cd_id,'8','N') ;
UPDATE etl.stg_revenue SET pstng_cd_id = replace(pstng_cd_id,'9','E') ;

UPDATE etl.stg_revenue SET doc_id = replace(doc_id,'0','Z') ;
UPDATE etl.stg_revenue SET doc_id = replace(doc_id,'1','Y') ;
UPDATE etl.stg_revenue SET doc_id = replace(doc_id,'2','X') ;
UPDATE etl.stg_revenue SET doc_id = replace(doc_id,'3','G') ;
UPDATE etl.stg_revenue SET doc_id = replace(doc_id,'4','F') ;
UPDATE etl.stg_revenue SET doc_id = replace(doc_id,'5','E') ;
UPDATE etl.stg_revenue SET doc_id = replace(doc_id,'6','D') ;
UPDATE etl.stg_revenue SET doc_id = replace(doc_id,'7','A') ;
UPDATE etl.stg_revenue SET doc_id = replace(doc_id,'8','B') ;
UPDATE etl.stg_revenue SET doc_id = replace(doc_id,'9','C') ;



-- Revenue Budget Scripts

DELETE FROM etl.stg_revenue_budget WHERE agency_code NOT in ('781','003','102','042','130','810','836','126','127','819');


-- Scripts after creating demo database


UPDATE ref_agency SET is_display = 'N';

UPDATE ref_agency SET is_display = 'Y' WHERE agency_code IN ('781','003','102','042','130','810','836','126','127','819');

UPDATE ref_industry_type SET industry_type_name = 'IT Services' WHERE industry_type_id = 1;
UPDATE ref_industry_type SET industry_type_name = 'Telecom Services' WHERE industry_type_id = 2;
UPDATE ref_industry_type SET industry_type_name = 'Infrastructure Services' WHERE industry_type_id = 3;
UPDATE ref_industry_type SET industry_type_name = 'Automobiles' WHERE industry_type_id = 4;

UPDATE ref_award_method SET award_method_name = 'AWARD METHOD' || award_method_id;


-- Creating foreign keys

ALTER TABLE  ref_agency_history ADD constraint fk_ref_agency_history_ref_agency FOREIGN KEY(agency_id) references ref_agency(agency_id);
ALTER TABLE  ref_month ADD constraint fk_ref_month_ref_year FOREIGN KEY(year_id) references ref_year(year_id);
ALTER TABLE  ref_date ADD constraint fk_ref_date_ref_month FOREIGN KEY(calendar_month_id) references ref_month(month_id);
ALTER TABLE  ref_date ADD constraint fk_ref_date_ref_year FOREIGN KEY(nyc_year_id) references ref_year(year_id); 
ALTER TABLE  ref_department ADD constraint fk_ref_department_ref_fund_class FOREIGN KEY(fund_class_id) references ref_fund_class (fund_class_id);
ALTER TABLE  ref_department ADD constraint fk_ref_department_ref_agency foreign key (agency_id) references ref_agency (agency_id);
ALTER TABLE  ref_department_history ADD constraint fk_ref_department_history_ref_fund_class FOREIGN KEY(fund_class_id) references ref_fund_class (fund_class_id);
ALTER TABLE  ref_department_history ADD constraint fk_ref_department_history_ref_agency foreign key (agency_id) references ref_agency (agency_id);
ALTER TABLE  ref_department_history ADD constraint fk_ref_department_history_ref_department FOREIGN KEY(department_id) references ref_department(department_id);
ALTER TABLE  ref_budget_code ADD constraint fk_ref_budget_code_ref_fund_class foreign key (fund_class_id) references ref_fund_class (fund_class_id);
ALTER TABLE  ref_budget_code ADD constraint fk_ref_budget_code_ref_agency FOREIGN KEY (agency_id) REFERENCES ref_agency(agency_id);
ALTER TABLE  ref_expenditure_object_history ADD constraint fk_ref_exp_object_history_ref_exp_object foreign key (expenditure_object_id) references ref_expenditure_object (expenditure_object_id);
ALTER TABLE  ref_location ADD CONSTRAINT fk_ref_location_ref_agency FOREIGN KEY (agency_id) REFERENCES ref_agency(agency_id);
ALTER TABLE  ref_location_history ADD CONSTRAINT fk_ref_location_history_ref_agency FOREIGN KEY (agency_id) REFERENCES ref_agency(agency_id);
ALTER TABLE  ref_location_history ADD CONSTRAINT fk_ref_location_history_ref_location FOREIGN KEY (location_id) REFERENCES ref_location(location_id);
ALTER TABLE  ref_object_class 	ADD constraint fk_ref_object_class_ref_date foreign key (effective_begin_date_id) references ref_date (date_id);
ALTER TABLE  ref_object_class 	ADD constraint fk_ref_object_class_ref_date_1 foreign key (effective_end_date_id) references ref_date (date_id);
ALTER TABLE  ref_object_class_history 	ADD constraint fk_ref_object_class_history_ref_date foreign key (effective_begin_date_id) references ref_date (date_id);
ALTER TABLE  ref_object_class_history 	ADD constraint fk_ref_object_class_history_ref_date_1 foreign key (effective_end_date_id) references ref_date (date_id);
ALTER TABLE  ref_object_class_history 	ADD constraint fk_ref_obj_class_history_ref_obj_class foreign key (object_class_id) references ref_object_class (object_class_id);
ALTER TABLE  ref_revenue_source ADD constraint fk_ref_revenue_source_ref_funding_class foreign key (funding_class_id) references ref_funding_class (funding_class_id);
ALTER TABLE  ref_revenue_source ADD constraint fk_ref_revenue_source_ref_revenue_class foreign key (revenue_class_id) references ref_revenue_class (revenue_class_id);
ALTER TABLE  ref_revenue_source ADD constraint fk_ref_revenue_source_ref_revenue_category foreign key (revenue_category_id) references ref_revenue_category (revenue_category_id);
ALTER TABLE vendor_history ADD CONSTRAINT fk_vendor_history_vendor FOREIGN KEY (vendor_id) references vendor(vendor_id);
ALTER TABLE vendor_address ADD constraint fk_vendor_address_vendor_history foreign key (vendor_history_id) references vendor_history (vendor_history_id);
ALTER TABLE vendor_address ADD constraint fk_vendor_address_address foreign key (address_id) references address (address_id);
ALTER TABLE vendor_address ADD constraint fk_vendor_address_ref_address_type foreign key (address_type_id) references ref_address_type (address_type_id);
ALTER TABLE vendor_address ADD constraint fk_vendor_addressr_ref_date foreign key (effective_begin_date_id) references ref_date (date_id);
ALTER TABLE vendor_address ADD constraint fk_vendor_address_ref_date_1 foreign key (effective_end_date_id) references ref_date (date_id);  
ALTER TABLE vendor_business_type ADD constraint fk_vendor_business_type_vendor_history foreign key (vendor_history_id) references vendor_history (vendor_history_id);
ALTER TABLE vendor_business_type ADD constraint fk_vendor_business_type_ref_business_type foreign key (business_type_id) references ref_business_type (business_type_id);
ALTER TABLE vendor_business_type ADD constraint fk_vendor_business_type_ref_minority_type foreign key (minority_type_id) references ref_minority_type (minority_type_id);
ALTER TABLE  history_master_agreement ADD CONSTRAINT fk_history_master_agreement_ref_agency_history FOREIGN KEY (agency_history_id) REFERENCES ref_agency_history(agency_history_id);
ALTER TABLE  history_master_agreement ADD CONSTRAINT fk_history_master_agreement_ref_agreement_type FOREIGN KEY (agreement_type_id) REFERENCES ref_agreement_type(agreement_type_id);
ALTER TABLE  history_master_agreement ADD CONSTRAINT fk_history_master_agreement_ref_award_category_1 FOREIGN KEY (award_category_id_1) REFERENCES ref_award_category(award_category_id);
ALTER TABLE  history_master_agreement ADD CONSTRAINT fk_history_master_agreement_ref_award_category_2 FOREIGN KEY (award_category_id_2) REFERENCES ref_award_category(award_category_id);
ALTER TABLE  history_master_agreement ADD CONSTRAINT fk_history_master_agreement_ref_award_category_3 FOREIGN KEY (award_category_id_3) REFERENCES ref_award_category(award_category_id);
ALTER TABLE  history_master_agreement ADD CONSTRAINT fk_history_master_agreement_ref_award_category_4 FOREIGN KEY (award_category_id_4) REFERENCES ref_award_category(award_category_id);
ALTER TABLE  history_master_agreement ADD CONSTRAINT fk_history_master_agreement_ref_award_category_5 FOREIGN KEY (award_category_id_5) REFERENCES ref_award_category(award_category_id);
ALTER TABLE  history_master_agreement ADD CONSTRAINT fk_history_master_agreement_ref_award_method FOREIGN KEY (award_method_id) REFERENCES ref_award_method(award_method_id);
ALTER TABLE  history_master_agreement ADD CONSTRAINT fk_history_master_agreement_ref_document_code FOREIGN KEY (document_code_id) REFERENCES ref_document_code(document_code_id);
ALTER TABLE  history_master_agreement ADD CONSTRAINT fk_history_master_agreement_vendor_history FOREIGN KEY (vendor_history_id) REFERENCES vendor_history(vendor_history_id);
ALTER TABLE  history_master_agreement ADD constraint fk_history_master_agreement_ref_date foreign key (record_date_id) references ref_date (date_id);
ALTER TABLE  history_master_agreement ADD constraint fk_history_master_agreement_ref_date_1 foreign key (effective_begin_date_id) references ref_date (date_id);
ALTER TABLE  history_master_agreement ADD constraint fk_history_master_agreement_ref_date_2 foreign key (effective_end_date_id) references ref_date (date_id);
ALTER TABLE  history_master_agreement ADD constraint fk_history_master_agreement_ref_date_3 foreign key (source_created_date_id) references ref_date (date_id);
ALTER TABLE  history_master_agreement ADD constraint fk_history_master_agreement_ref_date_4 foreign key (source_updated_date_id) references ref_date (date_id);
ALTER TABLE  history_master_agreement ADD constraint fk_history_master_agreement_ref_date_5 foreign key (board_approved_award_date_id) references ref_date (date_id);
ALTER TABLE  history_master_agreement ADD constraint fk_history_master_agreement_ref_date_6 foreign key (original_term_begin_date_id) references ref_date (date_id);
ALTER TABLE  history_master_agreement ADD constraint fk_history_master_agreement_ref_date_7 foreign key (original_term_end_date_id) references ref_date (date_id);
ALTER TABLE  history_master_agreement ADD constraint fk_history_master_agreement_ref_date_8 foreign key (registered_date_id) references ref_date (date_id); 
ALTER TABLE  payroll_summary ADD constraint fk_payroll_summary_ref_exp_object_history foreign key (expenditure_object_history_id) references ref_expenditure_object_history (expenditure_object_history_id);
ALTER TABLE  payroll_summary ADD constraint fk_payroll_summary_ref_department_history FOREIGN KEY (department_history_id) REFERENCES ref_department_history(department_history_id);
ALTER TABLE  payroll_summary ADD constraint fk_payroll_summary_ref_budget_code foreign key (budget_code_id) references ref_budget_code (budget_code_id);
ALTER TABLE  payroll_summary ADD constraint fk_payroll_summary_ref_agency_summary foreign key (agency_history_id) references ref_agency_history (agency_history_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_agency_history FOREIGN KEY (agency_history_id) REFERENCES ref_agency_history(agency_history_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_agency_history_2 FOREIGN KEY (document_agency_history_id) REFERENCES ref_agency_history(agency_history_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_agency_history_3 FOREIGN KEY (ref_document_agency_history_id) REFERENCES ref_agency_history(agency_history_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_budget_code FOREIGN KEY (budget_code_id) REFERENCES ref_budget_code(budget_code_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_department_history FOREIGN KEY (department_history_id) REFERENCES ref_department_history(department_history_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_document_code FOREIGN KEY (document_code_id) REFERENCES ref_document_code(document_code_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_document_code_2 FOREIGN KEY (ref_document_code_id) REFERENCES ref_document_code(document_code_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_exp_object_history FOREIGN KEY (expenditure_object_history_id) REFERENCES ref_expenditure_object_history(expenditure_object_history_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_fund_class FOREIGN KEY (fund_class_id) REFERENCES ref_fund_class(fund_class_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_funding_source FOREIGN KEY (funding_source_id) REFERENCES ref_funding_source(funding_source_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_object_class_history FOREIGN KEY (object_class_history_id) REFERENCES ref_object_class_history(object_class_history_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_revenue_category FOREIGN KEY (revenue_category_id) REFERENCES ref_revenue_category(revenue_category_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_revenue_class FOREIGN KEY (revenue_class_id) REFERENCES ref_revenue_class(revenue_class_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_revenue_source FOREIGN KEY (revenue_source_id) REFERENCES ref_revenue_source(revenue_source_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_vendor_history FOREIGN KEY (vendor_history_id) REFERENCES vendor_history(vendor_history_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_date FOREIGN KEY (record_date_id) REFERENCES ref_date(date_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_date_1 FOREIGN KEY (service_start_date_id) REFERENCES ref_date(date_id);
ALTER TABLE  revenue ADD CONSTRAINT fk_revenue_ref_date_2 FOREIGN KEY (service_end_date_id) REFERENCES ref_date(date_id);
ALTER TABLE  budget ADD constraint fk_budget_ref_fund_class foreign key (fund_class_id) references ref_fund_class (fund_class_id);
ALTER TABLE  budget ADD constraint fk_budget_ref_agency_history FOREIGN KEY (agency_history_id) REFERENCES ref_agency_history(agency_history_id);
ALTER TABLE  budget ADD constraint fk_budget_ref_department_history FOREIGN KEY (department_history_id) REFERENCES ref_department_history(department_history_id);
ALTER TABLE  budget ADD constraint fk_budget_ref_budget_code foreign key (budget_code_id) references ref_budget_code (budget_code_id);
ALTER TABLE  budget ADD constraint fk_budget_ref_object_class_history foreign key (object_class_history_id) references ref_object_class_history (object_class_history_id);
ALTER TABLE  budget ADD constraint fk_budget_ref_date foreign key (source_updated_date_id) references ref_date (date_id);
ALTER TABLE  revenue_budget ADD  CONSTRAINT fk_revenue_budget_ref_agency_history FOREIGN KEY (agency_history_id)  REFERENCES ref_agency_history (agency_history_id);
ALTER TABLE  revenue_budget ADD  CONSTRAINT fk_revenue_budget_ref_budget_code FOREIGN KEY (budget_code_id) REFERENCES ref_budget_code (budget_code_id);
ALTER TABLE  revenue_budget ADD  CONSTRAINT fk_revenue_budget_ref_fund_class FOREIGN KEY (fund_class_id) REFERENCES ref_fund_class (fund_class_id);
ALTER TABLE  revenue_details ADD CONSTRAINT fk_revenue_details_ref_revenue_category FOREIGN KEY (revenue_category_id) REFERENCES ref_revenue_category(revenue_category_id);
ALTER TABLE  revenue_details ADD CONSTRAINT fk_revenue_details_ref_revenue_source FOREIGN KEY (revenue_source_id) REFERENCES ref_revenue_source(revenue_source_id);
ALTER TABLE  revenue_details ADD CONSTRAINT fk_revenue_detailse_revenue FOREIGN KEY (revenue_id) REFERENCES revenue(revenue_id);
ALTER TABLE  disbursement ADD CONSTRAINT fk_disbursement_ref_agency_history FOREIGN KEY (agency_history_id) REFERENCES ref_agency_history(agency_history_id);
ALTER TABLE  disbursement ADD CONSTRAINT fk_disbursement_ref_document_code FOREIGN KEY (document_code_id) REFERENCES ref_document_code(document_code_id);
ALTER TABLE  disbursement ADD CONSTRAINT fk_disbursement_ref_expenditure_cancel_reason FOREIGN KEY (expenditure_cancel_reason_id) REFERENCES ref_expenditure_cancel_reason(expenditure_cancel_reason_id);
ALTER TABLE  disbursement ADD CONSTRAINT fk_disbursement_ref_expenditure_cancel_type FOREIGN KEY (expenditure_cancel_type_id) REFERENCES ref_expenditure_cancel_type(expenditure_cancel_type_id);
ALTER TABLE  disbursement ADD CONSTRAINT fk_disbursement_ref_expenditure_status FOREIGN KEY (expenditure_status_id) REFERENCES ref_expenditure_status(expenditure_status_id);
ALTER TABLE  disbursement ADD CONSTRAINT fk_disbursement_vendor_history FOREIGN KEY (vendor_history_id) REFERENCES vendor_history(vendor_history_id);
ALTER TABLE  disbursement ADD constraint fk_disbursement_ref_date foreign key (record_date_id) references ref_date (date_id);
ALTER TABLE  disbursement ADD constraint fk_disbursement_ref_date_1 foreign key (check_eft_issued_date_id) references ref_date (date_id);
ALTER TABLE  disbursement ADD constraint fk_disbursement_ref_date_2 foreign key (check_eft_record_date_id) references ref_date (date_id);
ALTER TABLE  disbursement_line_item ADD constraint fk_disbursement_line_item_expenditure foreign key (disbursement_id) references disbursement (disbursement_id);
ALTER TABLE  disbursement_line_item ADD constraint fk_disbursement_line_item_ref_fund_class foreign key (fund_class_id) references ref_fund_class (fund_class_id);
ALTER TABLE  disbursement_line_item ADD constraint fk_disbursement_line_item_ref_agency_history FOREIGN KEY (agency_history_id) REFERENCES ref_agency_history(agency_history_id);
ALTER TABLE  disbursement_line_item ADD constraint fk_disbursement_line_item_ref_department_history FOREIGN KEY (department_history_id) REFERENCES ref_department_history(department_history_id);
ALTER TABLE  disbursement_line_item ADD constraint fk_disb_line_item_ref_exp_object_history foreign key (expenditure_object_history_id) references ref_expenditure_object_history (expenditure_object_history_id);
ALTER TABLE  disbursement_line_item ADD constraint fk_disbursement_line_item_ref_budget_code foreign key (budget_code_id) references ref_budget_code (budget_code_id);
ALTER TABLE  disbursement_line_item ADD constraint fk_disbursement_line_item_agreement foreign key (agreement_id) references history_agreement (agreement_id);
ALTER TABLE  disbursement_line_item ADD constraint fk_disbursement_line_item_ref_location_history foreign key (location_history_id) references ref_location_history (location_history_id);
ALTER TABLE  employee_history ADD constraint fk_employee_history_employee foreign key (employee_id) references employee (employee_id);
ALTER TABLE  payroll ADD constraint fk_payroll_ref_date foreign key (pay_date_id) references ref_date (date_id);
ALTER TABLE  payroll ADD constraint fk_payroll_employee_history foreign key (employee_history_id) references employee_history (employee_history_id);
ALTER TABLE  payroll ADD constraint fk_payroll_ref_agency_history foreign key (agency_history_id) references ref_agency_history (agency_history_id);
ALTER TABLE  payroll ADD constraint fk_payroll_ref_date_1 foreign key (orig_pay_date_id) references ref_date (date_id);
ALTER TABLE  payroll ADD constraint fk_payroll_ref_department_history foreign key (department_history_id) references ref_department_history (department_history_id);
ALTER TABLE  payroll ADD constraint fk_payroll_ref_amount_basis foreign key (amount_basis_id) references ref_amount_basis (amount_basis_id);



-- ADD Primary keys (Already added)
/*
ALTER TABLE history_agreement ADD PRIMARY KEY (agreement_id);
ALTER TABLE history_master_agreement ADD PRIMARY KEY (master_agreement_id);
ALTER TABLE history_agreement_accounting_line ADD PRIMARY KEY (agreement_accounting_line_id);

ALTER TABLE employee ADD PRIMARY KEY (employee_id);
ALTER TABLE payroll ADD PRIMARY KEY (payroll_id);
ALTER TABLE payroll_summary ADD PRIMARY KEY (payroll_summary_id);
ALTER TABLE disbursement ADD PRIMARY KEY (disbursement_id);
ALTER TABLE disbursement_line_item ADD PRIMARY KEY (disbursement_line_item_id);
ALTER TABLE disbursement_line_item_details ADD PRIMARY KEY (disbursement_line_item_id);
ALTER TABLE vendor ADD PRIMARY KEY (vendor_id);
ALTER TABLE ref_agency ADD PRIMARY KEY (agency_id);
ALTER TABLE ref_department ADD PRIMARY KEY (department_id);
ALTER TABLE ref_expenditure_object ADD PRIMARY KEY (expenditure_object_id);
ALTER TABLE ref_budget_code ADD PRIMARY KEY (budget_code_id);
ALTER TABLE ref_location ADD PRIMARY KEY (location_id);
ALTER TABLE ref_industry_type ADD PRIMARY KEY (industry_type_id);
ALTER TABLE ref_award_method ADD PRIMARY KEY (award_method_id);
*/

-- ADD indexes for distributed by columns that are not primary keys

CREATE INDEX idx_original_agreement_id_agreement_snapshot ON agreement_snapshot(original_agreement_id);
CREATE INDEX idx_original_agreement_id_agreement_snapshot_cy ON agreement_snapshot_cy(original_agreement_id);
CREATE INDEX idx_vendor_id_agg_contracts_cum_spending ON aggregateon_contracts_cumulative_spending(vendor_id);
CREATE INDEX idx_department_id_agg_contracts_department ON aggregateon_contracts_department(department_id);
CREATE INDEX idx_original_agreement_id_agg_contracts_expense ON aggregateon_contracts_expense(original_agreement_id);
CREATE INDEX idx_vendor_id_agg_contracts_spend_by_month ON aggregateon_contracts_spending_by_month(vendor_id);
CREATE INDEX idx_fiscal_year_agg_total_contracts ON aggregateon_total_contracts(fiscal_year);

CREATE INDEX idx_disbursement_line_item_id_cont_spen_transactions ON contracts_spending_transactions(disbursement_line_item_id);
CREATE INDEX idx_agency_id_agg_payroll_agency ON aggregateon_payroll_agency(agency_id);
CREATE INDEX idx_agency_id_agg_payroll_agency_month ON aggregateon_payroll_agency_month(agency_id);
CREATE INDEX idx_agency_id_agg_payroll_coa_month ON aggregateon_payroll_coa_month(agency_id);
CREATE INDEX idx_employee_id_agg_payroll_employee_agency ON aggregateon_payroll_employee_agency(employee_id);
CREATE INDEX idx_employee_id_agg_payroll_employee_agency_month ON aggregateon_payroll_employee_agency_month(employee_id);

CREATE INDEX idx_department_id_agg_spen_coa_entities ON aggregateon_spending_coa_entities(department_id);
CREATE INDEX idx_agreement_id_agg_spen_contract ON aggregateon_spending_contract(agreement_id);
CREATE INDEX idx_vendor_id_agg_spen_vendor ON aggregateon_spending_vendor(vendor_id);
CREATE INDEX idx_expenditure_object_id_agg_spen_vendor_exp_object ON aggregateon_spending_vendor_exp_object(expenditure_object_id);


-- Vacuum analyze all the tables

vacuum analyze	history_agreement;
vacuum analyze	history_master_agreement;
vacuum analyze history_agreement_accounting_line;
vacuum analyze	employee;
vacuum analyze	payroll;
vacuum analyze	payroll_summary;
vacuum analyze	disbursement;
vacuum analyze	disbursement_line_item;
vacuum analyze	disbursement_line_item_details;
vacuum analyze	vendor;
vacuum analyze	budget;
vacuum analyze	revenue;
vacuum analyze	revenue_budget;
vacuum analyze	ref_agency;
vacuum analyze	ref_department;
vacuum analyze	ref_expenditure_object;
vacuum analyze	ref_budget_code;
vacuum analyze	ref_location;
vacuum analyze	ref_industry_type;
vacuum analyze	ref_award_method;
vacuum analyze	ref_funding_class;
vacuum analyze	ref_revenue_source;
vacuum analyze	ref_revenue_category;
vacuum analyze	ref_revenue_class;
vacuum analyze	ref_object_class;

	
vacuum analyze	agreement_snapshot;
vacuum analyze	agreement_snapshot_cy;
vacuum analyze	aggregateon_contracts_cumulative_spending;
vacuum analyze	aggregateon_contracts_department;
vacuum analyze	aggregateon_contracts_expense;
vacuum analyze	aggregateon_contracts_spending_by_month;
vacuum analyze	aggregateon_total_contracts;
	
vacuum analyze	contracts_spending_transactions;
vacuum analyze	aggregateon_payroll_agency;
vacuum analyze	aggregateon_payroll_agency_month;
vacuum analyze	aggregateon_payroll_coa_month;
vacuum analyze	aggregateon_payroll_employee_agency;
vacuum analyze	aggregateon_payroll_employee_agency_month;
	
vacuum analyze	aggregateon_spending_coa_entities;
vacuum analyze	aggregateon_spending_contract;
vacuum analyze	aggregateon_spending_vendor;
vacuum analyze	aggregateon_spending_vendor_exp_object;
vacuum analyze	revenue_details;
vacuum analyze	aggregateon_revenue_category_funding_class;
vacuum analyze	aggregateon_revenue_category_funding_by_year;


-- TRUNCATE staging and archive tables

TRUNCATE TABLE stg_mag_commodity; 
TRUNCATE TABLE stg_fmsv_business_type; 
TRUNCATE TABLE stg_con_ct_commodity; 
TRUNCATE TABLE stg_con_po_commodity; 
TRUNCATE TABLE stg_con_do1_commodity; 
TRUNCATE TABLE stg_agreement_type; 
TRUNCATE TABLE stg_award_category; 
TRUNCATE TABLE stg_award_method; 
TRUNCATE TABLE stg_award_category_industry; 
TRUNCATE TABLE stg_agency; 
TRUNCATE TABLE stg_expenditure_object; 
TRUNCATE TABLE stg_budget_code; 
TRUNCATE TABLE stg_department; 
TRUNCATE TABLE stg_location; 
TRUNCATE TABLE stg_funding_class; 
TRUNCATE TABLE stg_revenue_category; 
TRUNCATE TABLE stg_revenue_class; 
TRUNCATE TABLE stg_object_class; 
TRUNCATE TABLE stg_revenue_source; 
TRUNCATE TABLE stg_budget; 
TRUNCATE TABLE stg_mag_header; 
TRUNCATE TABLE stg_mag_award_detail; 
TRUNCATE TABLE stg_mag_vendor; 
TRUNCATE TABLE stg_revenue_budget; 
TRUNCATE TABLE stg_revenue; 
TRUNCATE TABLE stg_con_ct_header; 
TRUNCATE TABLE stg_con_ct_award_detail; 
TRUNCATE TABLE stg_con_ct_vendor; 
TRUNCATE TABLE stg_con_ct_accounting_line; 
TRUNCATE TABLE stg_con_po_header; 
TRUNCATE TABLE stg_con_po_award_detail; 
TRUNCATE TABLE stg_con_po_vendor; 
TRUNCATE TABLE stg_con_po_accounting_line; 
TRUNCATE TABLE stg_con_do1_header; 
TRUNCATE TABLE stg_con_do1_vendor; 
TRUNCATE TABLE stg_con_do1_accounting_line; 
TRUNCATE TABLE stg_payroll; 
TRUNCATE TABLE stg_fms_header; 
TRUNCATE TABLE stg_fms_vendor; 
TRUNCATE TABLE stg_fms_accounting_line; 
TRUNCATE TABLE stg_payroll_summary; 
TRUNCATE TABLE stg_pending_contracts; 


TRUNCATE TABLE archive_agency; 
TRUNCATE TABLE archive_department; 
TRUNCATE TABLE archive_expenditure_object; 
TRUNCATE TABLE archive_location; 
TRUNCATE TABLE archive_object_class; 
TRUNCATE TABLE archive_revenue_category; 
TRUNCATE TABLE archive_revenue_class; 
TRUNCATE TABLE archive_revenue_source; 
TRUNCATE TABLE archive_budget_code; 
TRUNCATE TABLE archive_funding_class; 
TRUNCATE TABLE archive_mag_header; 
TRUNCATE TABLE archive_mag_award_detail; 
TRUNCATE TABLE archive_mag_vendor; 
TRUNCATE TABLE archive_mag_commodity; 
TRUNCATE TABLE archive_fmsv_business_type; 
TRUNCATE TABLE archive_con_ct_header; 
TRUNCATE TABLE archive_con_ct_award_detail; 
TRUNCATE TABLE archive_con_ct_vendor; 
TRUNCATE TABLE archive_con_ct_commodity; 
TRUNCATE TABLE archive_con_ct_accounting_line; 
TRUNCATE TABLE archive_con_po_header; 
TRUNCATE TABLE archive_con_po_award_detail; 
TRUNCATE TABLE archive_con_po_vendor; 
TRUNCATE TABLE archive_con_po_commodity; 
TRUNCATE TABLE archive_con_po_accounting_line; 
TRUNCATE TABLE archive_con_do1_header; 
TRUNCATE TABLE archive_con_do1_vendor; 
TRUNCATE TABLE archive_con_do1_commodity; 
TRUNCATE TABLE archive_con_do1_accounting_line; 
TRUNCATE TABLE archive_fms_header; 
TRUNCATE TABLE archive_fms_vendor; 
TRUNCATE TABLE archive_fms_accounting_line; 
TRUNCATE TABLE archive_budget; 
TRUNCATE TABLE archive_revenue; 
TRUNCATE TABLE archive_revenue_budget; 
TRUNCATE TABLE archive_payroll; 
TRUNCATE TABLE archive_payroll_summary; 
TRUNCATE TABLE archive_pending_contracts; 
	
*/	
-- pg_dump  -Upostgres  checkbook_demo_from_dump 1>C:\Users\treddy\Desktop\DEMO_SITE\checkbook_demo_database_postgres_db_03_05.sql 2>C:\Users\treddy\Desktop\DEMO_SITE\2.err	

