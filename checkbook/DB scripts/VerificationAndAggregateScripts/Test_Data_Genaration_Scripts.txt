-- Latest Scripts as of 2013-02-20


-- Accounting|Advertising|Asset Management|Customer Relations|Customer Service|Finances|Human Resources|Legal Department|Media Relations|Payroll|Public Relations|Quality Assurance|Sales and Marketing|Research and Development|Tech Support
/*
Preliminary Requirements:
Sample data would contain data only for Ten agencies.
The data would span across multiple years-2010,2011 and 2012,2013.
The data for few columns for spending, payroll and contracts domain would be changed to use sample data. 
We will not be modifying the amounts  within contracts and spending domain as we have to match both these amounts as we include contracts and spending data within each domain.
 
Note: We have identified few fields which are most commonly used within these three domains throughout the application to be updated to use sample data as listed below. Please let us know if there are any other fields that need to be masked for sample data.
 
Sample Data Approach:
1.       COA Elements :
Tables to be modified:
1.       Department(Agency)
2.       Appropriation(Department)
3.       Expenditure Object

2.       Contracts Domain: Will be modifying contracts data for Ten Agencies. Fields to be modified are:-
 Contract Number -  Make sure the relationships between child contracts and parent contracts are not broken as you rename both. 
 Agency Name
 Department Name
 Vendor Name
 Award Method Name
 Contract Purpose
 Contract Industry Name
3.       Spending Domain : Will be modifying contracts data for Ten Agencies. Fields to be modified are:-
  Disbursement Number
  Vendor Name
  Agency Name
  Department Name
  Expense Category Name
4.       Payroll Domain: Will be modifying contracts data for Ten Agencies. Fields to be modified are:-
 Civil Service Title. 
  Employee Number
  Agency  Name
  Department Name
  
  */
  
  
  -- needs to add agencies with the codes (added)  '057','068','072','095','103','131','156','801','806','816','820','826','827','841','856','858'
  
  


--  Reference Tables

-- COA Agency

DELETE FROM etl.stg_agency WHERE agency_code NOT IN  ('781','003','102','042','130','810','836','126','127','819','DSB','856','827','858','156','068','095','816','103','841','820','806','131','826','801','072');

UPDATE etl.stg_agency SET  agency_name = 'Accounting Department', agency_short_name = 'ACD'  where agency_code = '003' ;
UPDATE etl.stg_agency SET  agency_name = 'Advertising Department', agency_short_name = 'ADD'  where agency_code = '042' ;
UPDATE etl.stg_agency SET  agency_name = 'Asset Management', agency_short_name = 'ASM'  where agency_code = '102' ;
UPDATE etl.stg_agency SET  agency_name = 'Customer Relations Department', agency_short_name = 'CRD'  where agency_code = '126' ;
UPDATE etl.stg_agency SET  agency_name = 'Customer Service Department', agency_short_name = 'CSD'  where agency_code = '127' ;
UPDATE etl.stg_agency SET  agency_name = 'Finance Department', agency_short_name = 'FID'  where agency_code = '130' ;
UPDATE etl.stg_agency SET  agency_name = 'Human resources', agency_short_name = 'HRD'  where agency_code = '781' ;
UPDATE etl.stg_agency SET  agency_name = 'Research And Development', agency_short_name = 'RAD'  where agency_code = '810' ;
UPDATE etl.stg_agency SET  agency_name = 'Sales And Marketing', agency_short_name = 'SAM'  where agency_code = '819' ;
UPDATE etl.stg_agency SET  agency_name = 'Public Relations', agency_short_name = 'PUR'  where agency_code = '836' ;

UPDATE etl.stg_agency SET  agency_name = 'Quality Assurance', agency_short_name = 'QAD'  where agency_code = '856' ;
UPDATE etl.stg_agency SET  agency_name = 'Legal Department', agency_short_name = 'LED'  where agency_code = '827' ;
UPDATE etl.stg_agency SET  agency_name = 'Media Relations', agency_short_name = 'MRD'  where agency_code = '858' ;
UPDATE etl.stg_agency SET  agency_name = 'IT Department', agency_short_name = 'ITD'  where agency_code = '156' ;
UPDATE etl.stg_agency SET  agency_name = 'Technology Support', agency_short_name = 'TSD'  where agency_code = '068' ;

UPDATE etl.stg_agency SET  agency_name = 'Fire Department', agency_short_name = 'FID'  where agency_code = '095' ;
UPDATE etl.stg_agency SET  agency_name = 'Development Board', agency_short_name = 'DEB'  where agency_code = '816' ;
UPDATE etl.stg_agency SET  agency_name = 'Manufacture Department', agency_short_name = 'MAD'  where agency_code = '103' ;
UPDATE etl.stg_agency SET  agency_name = 'TeleCommunications Department', agency_short_name = 'TCD'  where agency_code = '841' ;
UPDATE etl.stg_agency SET  agency_name = 'Airport Development', agency_short_name = 'AID'  where agency_code = '820' ;

UPDATE etl.stg_agency SET  agency_name = 'Misc Department1', agency_short_name = 'MID1'  where agency_code = '806' ;
UPDATE etl.stg_agency SET  agency_name = 'Misc Department2', agency_short_name = 'MID2'  where agency_code = '131' ;
UPDATE etl.stg_agency SET  agency_name = 'Misc Department3', agency_short_name = 'MID3'  where agency_code = '826' ;
UPDATE etl.stg_agency SET  agency_name = 'Misc Department4', agency_short_name = 'MID4'  where agency_code = '801' ;
UPDATE etl.stg_agency SET  agency_name = 'Misc Department5', agency_short_name = 'MID5'  where agency_code = '072' ;




-- COA Department

DELETE FROM etl.stg_department WHERE agency_code NOT IN  ('781','003','102','042','130','810','836','126','127','819','DSB','856','827','858','156','068','095','816','103','841','820','806','131','826','801','072');

DROP SEQUENCE IF EXISTS mtr_seq_temp_stg_ref_dept_name cascade;

CREATE SEQUENCE mtr_seq_temp_stg_ref_dept_name;

DROP TABLE IF EXISTS mtr_change_deptname;

CREATE TABLE mtr_change_deptname(
	dept_id int PRIMARY KEY default nextval('mtr_seq_temp_stg_ref_dept_name'),
	agency_code varchar(3),
	department_code varchar(3),
	agency_short_name varchar(5)
	)
DISTRIBUTED BY (dept_id);


INSERT INTO mtr_change_deptname(agency_code, department_code, agency_short_name) SELECT distinct b.agency_code, b.department_code, a.agency_short_name from etl.stg_agency a, etl.stg_department b  WHERE a.agency_code = b.agency_code ;

UPDATE etl.stg_department a 
SET department_name = b.agency_short_name || ' DEPARTMENT ' || b.dept_id, 
    department_short_name = b.agency_short_name || '_DEPT_' || b.dept_id
FROM mtr_change_deptname b
WHERE a.agency_code = b.agency_code AND a.department_code = b.department_code;

-- COA Expenditure Object

DROP SEQUENCE IF EXISTS mtr_seq_temp_stg_ref_exp_object_name cascade;

CREATE SEQUENCE mtr_seq_temp_stg_ref_exp_object_name;

DROP TABLE IF EXISTS etl.stg_expenditure_object_mtr;


CREATE TABLE etl.stg_expenditure_object_mtr(
	exp_obj_id int PRIMARY KEY default nextval('mtr_seq_temp_stg_ref_exp_object_name'),
	expenditure_object_code varchar(4)
	)
DISTRIBUTED BY (exp_obj_id);

INSERT INTO etl.stg_expenditure_object_mtr(expenditure_object_code) select distinct expenditure_object_code from etl.stg_expenditure_object;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'AIR FARE ' || b.exp_obj_id , col5 = 'AF_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^0[0-4][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'CAR RENTAL ' || b.exp_obj_id , col5 = 'CR_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^0[5-6][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'ACCOMMODATION ' || b.exp_obj_id , col5 = 'AC_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^0[7-9][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'REAL PROPERTY LEASE ' || b.exp_obj_id , col5 = 'RPL_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^1[0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'BUILDING REPAIRS ' || b.exp_obj_id , col5 = 'BR_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^2[0-1][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'NATURAL GAS ' || b.exp_obj_id , col5 = 'NG_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^2[2-3][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'ELECTRICITY ' || b.exp_obj_id , col5 = 'EL_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^2[4-9][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'STOCKS ' || b.exp_obj_id , col5 = 'ST_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^3[0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'OFT TELECOMMUNICATIONS ' || b.exp_obj_id , col5 = 'OTC_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^40[0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'OFT COMPUTER SERVICES ' || b.exp_obj_id , col5 = 'OCS_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^4[1-2][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'TELEPHONE SERVICES ' || b.exp_obj_id , col5 = 'TS_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^4[3-5][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'IT TELECOMMUNICATION SERVICES ' || b.exp_obj_id , col5 = 'ITTS_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^4[6-8][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'IT SERVICES ' || b.exp_obj_id , col5 = 'ITS_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^49[0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'JURY SERVICES ' || b.exp_obj_id , col5 = 'JS_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^5[0-1][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'PRINTING ' || b.exp_obj_id , col5 = 'PR_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^5[2-9][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'ADVERTISING ' || b.exp_obj_id , col5 = 'AD_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^6[0-3][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'VEHICLES ' || b.exp_obj_id , col5 = 'VH_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^6[4-5][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'STUDENT FEES ' || b.exp_obj_id , col5 = 'SF_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^6[6-9][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'MEDICAL EQUIPMENT ' || b.exp_obj_id , col5 = 'ME_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^7[0-1][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'HEALTH INSURANCE ' || b.exp_obj_id , col5 = 'HI_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^7[2-5][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'HOSPITAL MEDICARE ' || b.exp_obj_id , col5 = 'HM_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^7[6-9][0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'COMISSIONS ' || b.exp_obj_id , col5 = 'CO_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^8[0-9a-zA-Z]*$' ;

UPDATE etl.stg_expenditure_object a set expenditure_object_name = 'DIVIDENDS ' || b.exp_obj_id , col5 = 'DI_' || b.exp_obj_id
FROM   etl.stg_expenditure_object_mtr b where a.expenditure_object_code = b.expenditure_object_code AND a.expenditure_object_code ~* '^[9|[A-Za-z][0-9a-zA-Z]*$' ;


-- COA LOCATION

DELETE from etl.stg_location where agency_code NOT IN ('781','003','102','042','130','810','836','126','127','819','DSB','856','827','858','156','068','095','816','103','841','820','806','131','826','801','072');

-- COA Budget Code

DELETE from etl.stg_budget_code where dept_cd NOT IN ('781','003','102','042','130','810','836','126','127','819','DSB','856','827','858','156','068','095','816','103','841','820','806','131','826','801','072');

-- COA Vendor

UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'0','M') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'1','W') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'2','A') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'3','F') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'4','K') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'5','T') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'6','R') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'7','U') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'8','N') ;
UPDATE etl.stg_fmsv_business_type SET vend_cust_cd = replace(vend_cust_cd,'9','E') ;


-- Contracts Domain

 

-- Master Agreements


DELETE from etl.stg_mag_header where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819') ;
DELETE from etl.stg_mag_award_detail where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819')  ;
DELETE from etl.stg_mag_vendor where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819') ;

-- MAG header changes

UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'0','M')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'2','N')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'3','Y')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'4','T')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'5','R')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'6','U')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'7','E')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'8','J')  ;
UPDATE etl.stg_mag_header SET doc_id = replace(doc_id,'9','D')  ;

UPDATE etl.stg_mag_header a 
SET doc_dscr =  doc_cd || doc_dept_cd || doc_id || ' contract is for ' || b.agency_short_name 
FROM etl.stg_agency b WHERE a.doc_dept_cd = b.agency_code;

-- MAG Award Detail Changes

UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_mag_award_detail SET doc_id = replace(doc_id,'9','D') ;


-- MAG Vendor

UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_mag_vendor SET doc_id = replace(doc_id,'9','D') ;


UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'0','M') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'1','W') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'2','A') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'3','F') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'4','K') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'5','T') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'6','R') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'7','U') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'8','N') ;
UPDATE etl.stg_mag_vendor SET vend_cust_cd = replace(vend_cust_cd,'9','E') ;


UPDATE etl.stg_mag_vendor SET lgl_nm = 'VENDOR ' || vend_cust_cd, alias_nm = '', ad_ln_1 = 'Address Line 1' , ad_ln_2 = '' ;


--Contracts :

DELETE from etl.stg_con_ct_header where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_ct_accounting_line where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_ct_award_detail where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_ct_vendor where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');


DELETE from etl.stg_con_do1_header where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_do1_accounting_line where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_do1_vendor where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');

DELETE from etl.stg_con_po_header where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_po_accounting_line where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_po_award_detail where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');
DELETE from etl.stg_con_po_vendor where doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819');

-- CT header changes

UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'0','M'), oca_no = replace(oca_no,'0','M') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'1','A'), oca_no = replace(oca_no,'1','A') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'2','N'), oca_no = replace(oca_no,'2','N') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'3','Y'), oca_no = replace(oca_no,'3','Y') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'4','T'), oca_no = replace(oca_no,'4','T') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'5','R'), oca_no = replace(oca_no,'5','R') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'6','U'), oca_no = replace(oca_no,'6','U') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'7','E'), oca_no = replace(oca_no,'7','E') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'8','J'), oca_no = replace(oca_no,'8','J') ;
UPDATE etl.stg_con_ct_header SET doc_id = replace(doc_id,'9','D'), oca_no = replace(oca_no,'9','D') ;

UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'0','M')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'1','A') ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'2','N')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'3','Y')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'4','T')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'5','R')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'6','U')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'7','E')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'8','J')  ;
UPDATE etl.stg_con_ct_header SET agree_doc_id = replace(agree_doc_id,'9','D')  ;



UPDATE etl.stg_con_ct_header a 
SET doc_dscr =  a.doc_cd || a.doc_dept_cd || a.doc_id || ' contract is for ' || b.agency_short_name 
FROM etl.stg_agency b WHERE a.doc_dept_cd = b.agency_code;

-- UPDATE etl.stg_con_ct_header SET agree_doc_dept_cd = doc_dept_cd ;

-- CT accounting line changes

UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_ct_accounting_line SET doc_id = replace(doc_id,'9','D') ;

UPDATE etl.stg_con_ct_accounting_line SET dept_cd = doc_dept_cd;

-- CT Award Detail Changes

UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_ct_award_detail SET doc_id = replace(doc_id,'9','D') ;


-- CT Vendor

UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_ct_vendor SET doc_id = replace(doc_id,'9','D') ;


UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'0','M') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'1','W') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'2','A') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'3','F') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'4','K') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'5','T') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'6','R') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'7','U') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'8','N') ;
UPDATE etl.stg_con_ct_vendor SET vend_cust_cd = replace(vend_cust_cd,'9','E') ;


UPDATE etl.stg_con_ct_vendor SET lgl_nm = 'VENDOR ' || vend_cust_cd, alias_nm = '', ad_ln_1 = 'Address Line 1' , ad_ln_2 = '' ;


-- DO header changes

UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'0','M')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'1','A');
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'2','N')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'3','Y')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'4','T')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'5','R')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'6','U')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'7','E')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'8','J')  ;
UPDATE etl.stg_con_do1_header SET doc_id = replace(doc_id,'9','D')  ;

UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'0','M')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'1','A') ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'2','N')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'3','Y')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'4','T')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'5','R')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'6','U')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'7','E')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'8','J')  ;
UPDATE etl.stg_con_do1_header SET agree_doc_id = replace(agree_doc_id,'9','D')  ;


UPDATE etl.stg_con_do1_header a 
SET doc_dscr =  a.doc_cd || a.doc_dept_cd || a.doc_id || ' contract is for ' || b.agency_short_name 
FROM etl.stg_agency b WHERE a.doc_dept_cd = b.agency_code;

-- UPDATE etl.stg_con_do1_header SET agree_doc_dept_cd = doc_dept_cd ;

-- DO accounting line changes

UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_do1_accounting_line SET doc_id = replace(doc_id,'9','D') ;

UPDATE etl.stg_con_do1_accounting_line SET dept_cd = doc_dept_cd;

-- DO Vendor

UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_do1_vendor SET doc_id = replace(doc_id,'9','D') ;


UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'0','M') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'1','W') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'2','A') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'3','F') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'4','K') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'5','T') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'6','R') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'7','U') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'8','N') ;
UPDATE etl.stg_con_do1_vendor SET vend_cust_cd = replace(vend_cust_cd,'9','E') ;


UPDATE etl.stg_con_do1_vendor SET lgl_nm = 'VENDOR ' || vend_cust_cd, alias_nm = '', ad_ln_1 = 'Address Line 1' , ad_ln_2 = '' ;


-- PO header changes

UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'0','M')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'2','N')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'3','Y')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'4','T')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'5','R')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'6','U')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'7','E')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'8','J')  ;
UPDATE etl.stg_con_po_header SET doc_id = replace(doc_id,'9','D')  ;

UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'0','M')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'1','A') ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'2','N')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'3','Y')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'4','T')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'5','R')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'6','U')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'7','E')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'8','J')  ;
UPDATE etl.stg_con_po_header SET agree_doc_id = replace(agree_doc_id,'9','D')  ;

UPDATE etl.stg_con_po_header a 
SET doc_dscr =  a.doc_cd || a.doc_dept_cd || a.doc_id || ' contract is for ' || b.agency_short_name 
FROM etl.stg_agency b WHERE a.doc_dept_cd = b.agency_code;

-- UPDATE etl.stg_con_po_header SET agree_doc_dept_cd = doc_dept_cd ;

-- PO accounting line changes

UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_po_accounting_line SET doc_id = replace(doc_id,'9','D') ;

UPDATE etl.stg_con_po_accounting_line SET dept_cd = doc_dept_cd;

-- PO Award Detail Changes

UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_po_award_detail SET doc_id = replace(doc_id,'9','D') ;


-- PO Vendor

UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'0','M') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'2','N') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'3','Y') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'4','T') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'5','R') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'6','U') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'7','E') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'8','J') ;
UPDATE etl.stg_con_po_vendor SET doc_id = replace(doc_id,'9','D') ;


UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'0','M') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'1','W') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'2','A') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'3','F') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'4','K') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'5','T') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'6','R') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'7','U') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'8','N') ;
UPDATE etl.stg_con_po_vendor SET vend_cust_cd = replace(vend_cust_cd,'9','E') ;


UPDATE etl.stg_con_po_vendor SET lgl_nm = 'VENDOR ' || vend_cust_cd, alias_nm = '', ad_ln_1 = 'Address Line 1' , ad_ln_2 = '' ;



-- Spending Domain


DELETE FROM etl.stg_fms_accounting_line WHERE  rqporf_doc_dept_cd NOT in ('781','003','102','042','130','810','836','126','127','819') ;


DROP TABLE IF EXISTS etl.stg_fms_header_mtr;

CREATE TABLE etl.stg_fms_header_mtr as SELECT distinct  a.* FROM etl.stg_fms_header a , (select distinct doc_cd, doc_id, doc_dept_cd, doc_vers_no from etl.stg_fms_accounting_line) b WHERE a.doc_cd=b.doc_cd AND a.doc_id =b.doc_id AND a.doc_dept_cd = b.doc_dept_cd AND a.doc_vers_no = b.doc_vers_no ;

DELETE FROM etl.stg_fms_header WHERE uniq_id NOT IN (select distinct uniq_id FROM etl.stg_fms_header_mtr);


DROP TABLE IF EXISTS etl.stg_fms_vendor_mtr;

CREATE TABLE etl.stg_fms_vendor_mtr as SELECT distinct  a.* FROM etl.stg_fms_vendor a , (select distinct doc_cd, doc_id, doc_dept_cd, doc_vers_no from etl.stg_fms_accounting_line) b WHERE a.doc_cd=b.doc_cd AND a.doc_id =b.doc_id AND a.doc_dept_cd = b.doc_dept_cd AND a.doc_vers_no = b.doc_vers_no ;

DELETE FROM etl.stg_fms_vendor WHERE uniq_id NOT IN (select distinct uniq_id FROM etl.stg_fms_vendor_mtr);


-- FMS Header

UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'0','Y')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'2','T')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'3','I')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'4','S')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'5','H')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'6','R')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'7','E')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'8','D')  ;
UPDATE etl.stg_fms_header SET doc_id = replace(doc_id,'9','M')  ;

-- FMS Accounting Line

UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'0','Y')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'2','T')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'3','I')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'4','S')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'5','H')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'6','R')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'7','E')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'8','D')  ;
UPDATE etl.stg_fms_accounting_line SET doc_id = replace(doc_id,'9','M')  ;


UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'0','M') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'1','A') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'2','N') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'3','Y') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'4','T') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'5','R') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'6','U') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'7','E') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'8','J') ;
UPDATE etl.stg_fms_accounting_line SET rqporf_doc_id = replace(rqporf_doc_id,'9','D') ;

-- FMS Vendor

UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'0','Y')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'1','A') ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'2','T')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'3','I')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'4','S')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'5','H')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'6','R')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'7','E')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'8','D')  ;
UPDATE etl.stg_fms_vendor SET doc_id = replace(doc_id,'9','M')  ;


UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'0','M') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'1','W') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'2','A') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'3','F') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'4','K') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'5','T') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'6','R') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'7','U') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'8','N') ;
UPDATE etl.stg_fms_vendor SET vend_cust_cd = replace(vend_cust_cd,'9','E') ;


UPDATE etl.stg_fms_vendor SET lgl_nm = 'VENDOR ' || vend_cust_cd, alias_nm = '', ad_ln_1 = 'Address Line 1' , ad_ln_2 = '' ;


-- PAYROL Domain

-- Payroll Detail file

DROP TABLE IF EXISTS etl.stg_payroll_mtr;

CREATE TABLE etl.stg_payroll_mtr as SELECT * from etl.archive_payroll where agency_code in ('781','003','102','130','810','836','126','127','819');

TRUNCATE TABLE etl.stg_payroll ;

ALTER TABLE etl.stg_payroll_mtr DROP COLUMN load_file_id;

INSERT INTO etl.stg_payroll SELECT * FROM etl.stg_payroll_mtr;



UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'0','M') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'1','V') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'2','S') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'3','U') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'4','B') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'5','B') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'6','A') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'7','R') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'8','E') ;
UPDATE etl.stg_payroll SET employee_number = replace(employee_number,'9','D') ;


UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'0','M') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'1','T') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'2','A') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'3','R') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'4','U') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'5','N') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'6','T') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'7','E') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'8','J') ;
UPDATE etl.stg_payroll SET payroll_number = replace(payroll_number,'9','R') ;

UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'0','M') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'1','Y') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'2','A') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'3','T') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'4','I') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'5','S') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'6','H') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'7','R') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'8','E') ;
UPDATE etl.stg_payroll SET civil_service_code = replace(civil_service_code,'9','D') ;

UPDATE etl.stg_payroll SET civil_service_title = 'CIVIL SERVICE TITLE ' || payroll_number || civil_service_code ;

-- PAYROL SUMMARY FILE

DELETE from etl.stg_payroll_summary  where agency NOT IN ('781','003','102','130','810','836','126','127','819') ;

UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'0','M') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'1','T') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'2','A') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'3','R') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'4','U') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'5','N') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'6','T') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'7','E') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'8','J') ;
UPDATE etl.stg_payroll_summary SET pyrl_no = replace(pyrl_no,'9','R') ;





UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Accounting Department'  where agency = '003' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Advertising Department'  where agency = '042' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Asset Management'  where agency = '102' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Customer Relations Department' where agency = '126' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Customer Service Department'  where agency = '127' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Finance Department' where agency = '130' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Human resources'  where agency = '781' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Research And Development'  where agency = '810' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Sales And Marketing' where agency = '819' ;
UPDATE etl.stg_payroll_summary SET  pms_agency_name = 'Public Relations'  where agency = '836' ;


UPDATE etl.stg_payroll_summary a 
SET   uoa_name = b.agency_short_name || ' DEPARTMENT ' || b.dept_id
FROM mtr_change_deptname b
WHERE a.agency = b.agency_code AND a.uoa = b.department_code;


-- PENDING Contracts


DELETE from etl.stg_pending_contracts where con_trans_ad_code in ('781','003','102','042','130','810','836','126','127','819') ;

UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'0','M') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'1','A') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'2','N') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'3','Y') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'4','T') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'5','R') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'6','U') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'7','E') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'8','J') ;
UPDATE etl.stg_pending_contracts SET con_no = replace(con_no,'9','D') ;


UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'0','M') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'1','A') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'2','N') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'3','Y') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'4','T') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'5','R') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'6','U') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'7','E') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'8','J') ;
UPDATE etl.stg_pending_contracts SET con_par_reg_num = replace(con_par_reg_num,'9','D') ;


UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'0','M') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'1','W') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'2','A') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'3','F') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'4','K') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'5','T') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'6','R') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'7','U') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'8','N') ;
UPDATE etl.stg_pending_contracts SET con_vc_code = replace(con_vc_code,'9','E') ;

UPDATE etl.stg_pending_contracts SET vc_legal_name = 'VENDOR ' || con_vc_code, submitting_agency_code = con_trans_ad_code,awarding_agency_code = con_trans_ad_code ;

UPDATE etl.stg_pending_contracts a 
SET submitting_agency_desc = b.agency_name 
FROM etl.stg_agency b 
WHERE a.submitting_agency_code = b.agency_code;


UPDATE etl.stg_pending_contracts a 
SET awarding_agency_desc = b.agency_name 
FROM etl.stg_agency b 
WHERE a.awarding_agency_code = b.agency_code;

